{% extends "base/theme_base.html" %}

{% block page_title %}欢迎光临{% endblock %}

{% block single_js %}
<script type="text/javascript">
	$(document).ready(function(){
		$("#all_books").delegate("#pre, #next, #num", "click", function(){
			bookPageTurn(this);
		});
		$("#all_books").delegate("#goto_page", "click", function(){
			bookPageTurn(this);
		});
	});
	
	function bookPageTurn(obj){
		var pageIndex = "";
		if($(obj).attr("rel")==="userinput"){
			pageIndex = $("#userinput_page").val();
		}else{
			pageIndex = $(obj).attr("rel");
		}
		$.ajax({
			url: "/books/page_all_books/", 
			data: {"page": pageIndex}, 
			type: "get", 
			async: "true", 
			success: function(data){
				if(data.status=="success"){
					$("#all_books").html(data.html);
				}else{
					alert(data.status);
				}
			}, 
			error: function(){
				alert("error");
			},
			dataType: "json"
		});
	}
	
	function getByCate(cateName){
		$.ajax({
			url: "/books/getbycate/"+cateName,
			data: {},
			type: "get",
			async: "true",
			success: function(data){
				if(data.status=="success"){
					$("#all_books").html(data.html);
					$("#hot_two").html(data.html2);
				}else{
					alert(data.status);
				}
			},
			error: function(){
				alert("error");
			},
			dataType: "json"
		});
	}
</script>
{% endblock %}

{% block body_base %}
	<!-- 火爆数据 -->
	<div class="row">
    	<div class="span12">
        	<ul class="thumbnails">
        	{% for book in bestsellers %}
              <li class="span2">
                <a href="{% url book_detail book.id %}" class="thumbnail">
                  <img src="{{ MEDIA_URL }}img/{{book.spic}}" alt="">
                </a>
              </li>
            {% endfor %}
            </ul>
        </div>
    </div>
    
    <div class="row">
    	<div class="span4">
        	<ul class="nav nav-pills nav-stacked">
            	<li class="active"><a href="##" onclick="getByCate('all')">全部</a></li>
            	{% for cate in allCates %}
              	  <li><a href="##" onclick="getByCate('{{cate.name}}')">{{cate.label}}</a></li>
                {% endfor %}
            </ul>
        </div>
        <div class="span8">
        	<ul class="thumbnails" id="hot_two">
              {% include "base/hot_two_books.html" %}
			</ul>
        </div>
    </div>
    
	<div class="row">
		<div class="span12">
		    <ul class="breadcrumb">
		        <li><a href="#">销售</a> <span class="divider">|</span></li>
		        <li><a href="#">价格</a> <span class="divider">|</span></li>
		        <li><a href="#">评论数</a> <span class="divider">|</span></li>
		        <li><a href="#">上架时间</a> <span class="divider">|</span></li>
		        <li><a href="#">出版时间</a> <span class="divider">|</span></li>
		    </ul>
		</div>
	</div>
	
	<div class="row">
		    {% include "base/books_list.html" %}
	</div>
{% endblock %}
